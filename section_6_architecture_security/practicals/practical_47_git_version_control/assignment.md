# Практическое занятие 47: Система контроля версий Git

## Основы Git, ветвление, слияние, работа с удаленными репозиториями

### Цель занятия:
Научиться использовать систему контроля версий Git для управления исходным кодом, создавать и управлять ветками, выполнять слияние изменений, работать с удаленными репозиториями.

### Задачи:
1. Освоить основные команды Git
2. Научиться создавать и управлять ветками
3. Освоить слияние веток и разрешение конфликтов
4. Работать с удаленными репозиториями

### План работы:
1. Основы Git
2. Работа с репозиторием
3. Ветвление
4. Слияние и разрешение конфликтов
5. Удаленные репозитории
6. Практические задания

---

## 1. Основы Git

Git — распределенная система контроля версий, которая позволяет отслеживать изменения в файлах и координировать работу нескольких разработчиков над проектом.

### Пример 1: Установка и настройка Git

```bash
# Проверка установки Git
git --version

# Настройка пользователя (один раз на компьютере)
git config --global user.name "Ваше Имя"
git config --global user.email "ваш-email@example.com"

# Проверка настроек
git config --list
git config user.name
git config user.email
```

### Пример 2: Основные концепции Git

- **Repository (репозиторий)** — папка с проектом, в которой Git отслеживает изменения
- **Working Directory (рабочая директория)** — текущая директория с файлами проекта
- **Staging Area (область подготовки)** — промежуточное хранилище изменений перед коммитом
- **Commit (коммит)** — сохранение изменений с уникальным идентификатором
- **Branch (ветка)** — независимая линия разработки
- **HEAD** — указатель на текущий коммит

### Пример 3: Создание локального репозитория

```bash
# Инициализация репозитория в текущей директории
git init

# Инициализация репозитория в указанной директории
git init my-project

# Создание репозитория с удаленным origin
git init
git remote add origin https://github.com/username/repository.git
```

---

## 2. Работа с репозиторием

### Пример 4: Основные команды Git

```bash
# Проверка состояния репозитория
git status

# Добавление файлов в staging area
git add filename.txt          # Добавить конкретный файл
git add .                     # Добавить все файлы
git add *.py                  # Добавить все файлы с расширением .py
git add folder/               # Добавить всю папку

# Создание коммита
git commit -m "Описание изменений"
git commit -am "Описание изменений"  # Добавить и закоммитить изменения в отслеживаемых файлах

# Просмотр истории коммитов
git log
git log --oneline            # Компактный формат
git log --graph              # Графическое представление
git log --stat               # Статистика изменений
git log -p                   # Полные изменения

# Просмотр изменений
git diff                     # Изменения в рабочей директории
git diff --staged            # Изменения в staging area
git diff HEAD~1              # Изменения между текущим и предыдущим коммитом
```

### Пример 5: Игнорирование файлов

```bash
# Создание файла .gitignore
touch .gitignore

# Пример содержимого .gitignore
__pycache__/
*.pyc
*.pyo
*.pyd
.Python
env/
venv/
.env
.pytest_cache/
.coverage
htmlcov/
.DS_Store
```

### Пример 6: Отмена изменений

```bash
# Отменить изменения в файле (до добавления в staging)
git checkout -- filename.txt

# Отменить добавление файла в staging
git reset HEAD filename.txt

# Отменить последний коммит (сохранить изменения)
git reset --soft HEAD~1

# Отменить последний коммит (удалить изменения)
git reset --hard HEAD~1

# Отменить коммит, который не первый в ветке
git revert <commit-hash>
```

---

## 3. Ветвление

### Пример 7: Создание и переключение веток

```bash
# Просмотр всех веток
git branch
git branch -a                # Показать все ветки (включая удаленные)

# Создание новой ветки
git branch feature-login     # Создать ветку, не переключаясь на нее
git checkout -b feature-login  # Создать и переключиться на ветку
git switch -c feature-login    # Альтернатива checkout -b (Git 2.23+)

# Переключение между ветками
git checkout main
git switch main              # Альтернатива checkout (Git 2.23+)

# Переименование ветки
git branch -m old-name new-name
git branch -m new-name       # Переименовать текущую ветку
```

### Пример 8: Управление ветками

```bash
# Удаление ветки
git branch -d feature-login    # Удалить ветку (только если она слита)
git branch -D feature-login    # Принудительно удалить ветку

# Синхронизация с удаленным репозиторием
git fetch                    # Загрузить изменения из удаленного репозитория
git pull                     # Загрузить и слить изменения
git push origin feature-login  # Отправить ветку на удаленный репозиторий

# Удаление ветки на удаленном репозитории
git push origin --delete feature-login
git push origin :feature-login   # Альтернативный способ (устаревший)
```

---

## 4. Слияние и разрешение конфликтов

### Пример 9: Слияние веток

```bash
# Переключение на ветку, в которую будем сливать
git checkout main

# Слияние ветки feature-login с текущей
git merge feature-login

# Альтернатива - fast-forward merge
git merge --ff-only feature-login

# Создание merge-коммита даже если возможен fast-forward
git merge --no-ff feature-login
```

### Пример 10: Работа с конфликтами

```bash
# Когда происходит конфликт при слиянии:
# <<<<<<< HEAD
# Это содержимое в текущей ветке
# =======
# Это содержимое вливаемой ветки
# >>>>>>> feature-branch

# После разрешения конфликта:
git add conflicted_file.txt
git commit -m "Resolve merge conflict in conflicted_file.txt"
```

### Пример 11: Rebase vs Merge

```bash
# Rebase - переносит коммиты из одной ветки в другую
git checkout feature-branch
git rebase main

# Rebase с указанием базовой ветки
git rebase main feature-branch

# Интерактивный rebase - для редактирования истории коммитов
git rebase -i HEAD~3

# Cherry-pick - применить конкретный коммит из другой ветки
git cherry-pick <commit-hash>
```

---

## 5. Удаленные репозитории

### Пример 12: Работа с удаленными репозиториями

```bash
# Добавление удаленного репозитория
git remote add origin https://github.com/username/repository.git

# Просмотр удаленных репозиториев
git remote -v

# Изменение URL удаленного репозитория
git remote set-url origin https://github.com/newusername/newrepository.git

# Удаление удаленного репозитория
git remote remove origin

# Отправка изменений на удаленный репозиторий
git push origin main
git push -u origin main      # Установить upstream для ветки

# Получение изменений из удаленного репозитория
git fetch origin             # Только получить изменения
git pull origin main         # Получить и слить изменения

# Создание и отправка новой ветки
git checkout -b feature-new
git push origin feature-new

# Получение удаленной ветки
git fetch origin
git checkout -b feature-existing origin/feature-existing
```

### Пример 13: Работа с разными удаленными репозиториями

```bash
# Добавление нескольких удаленных репозиториев
git remote add origin https://github.com/primary-repo.git
git remote add upstream https://github.com/upstream-repo.git

# Работа с разными удалёнными репозиториями
git fetch upstream           # Получить изменения из upstream
git merge upstream/main      # Слить изменения из upstream в текущую ветку

# Отправка в разные удалённые репозитории
git push origin main
git push upstream main

# Управление ветками на удалённых репозиториях
git push origin --delete feature-old  # Удалить ветку на origin
git fetch --prune origin              # Удалить устаревшие локальные ветки, соответствующие удаленным
```

---

## 6. Продвинутые возможности Git

### Пример 14: Теги

```bash
# Создание тега
git tag v1.0.0                    # Легковесный тег
git tag -a v1.0.0 -m "Release 1.0.0"  # Аннотированный тег

# Просмотр тегов
git tag
git tag -l "v1.*"                 # Фильтрация по шаблону

# Просмотр информации о теге
git show v1.0.0

# Отправка тегов на удаленный репозиторий
git push origin v1.0.0            # Отправить конкретный тег
git push origin --tags            # Отправить все теги

# Создание ветки из тега
git checkout -b release-branch v1.0.0
```

### Пример 15: Stash

```bash
# Сохранение изменений в stash
git stash                       # Сохранить изменения
git stash save "work in progress"  # Сохранить с описанием

# Просмотр stash
git stash list
git stash show stash@{0}        # Показать изменения в конкретном stash

# Применение stash
git stash pop                   # Применить и удалить последний stash
git stash apply                 # Применить, но не удалять
git stash apply stash@{1}       # Применить конкретный stash

# Удаление stash
git stash drop stash@{0}        # Удалить конкретный stash
git stash clear                 # Удалить все stash
```

---

## 7. Практические задания

### Задание 1: Создание репозитория
Создайте новый репозиторий, выполните первоначальную настройку, создайте файл README.md и сделайте первый коммит.

### Задание 2: Работа с файлами
Создайте несколько файлов, добавьте их в репозиторий, внесите изменения, зафиксируйте их в коммитах.

### Задание 3: Ветвление
Создайте новую ветку для разработки новой функциональности, внесите изменения, слейте с основной веткой.

### Задание 4: Разрешение конфликтов
Создайте ситуацию с конфликтом при слиянии веток и разрешите его.

### Задание 5: Работа с удаленным репозиторием
Создайте репозиторий на GitHub, свяжите с локальным репозиторием, отправьте изменения.

---

## 8. Дополнительные задания

### Задание 6: Git flow
Используйте модель ветвления Git flow для управления разработкой.

### Задание 7: Cherry-pick
Попрактикуйтесь в использовании команды cherry-pick.

### Задание 8: Rebase
Сравните работу с rebase и merge на практике.

---

## Контрольные вопросы:
1. В чем разница между staging area и working directory?
2. Как создать и переключиться на новую ветку?
3. Как разрешить конфликт при слиянии веток?
4. Что такое fast-forward merge?
5. Как работать с несколькими удаленными репозиториями?